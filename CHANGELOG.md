# 更新日志

## 2026-02-04 - 暖色调主题 + 图谱刷新修复

### 🎨 UI 色调更新
**从紫色改为暖色系（燕麦色/卡其色）**

- ✅ 主背景：紫色渐变 → 琥珀色/黄色渐变 (`from-amber-100 to-yellow-200`)
- ✅ 顶部导航栏：紫色 → 琥珀色 (`bg-amber-800`)
- ✅ 按钮：紫色 → 琥珀色 (`bg-amber-700 hover:bg-amber-800`)
- ✅ 边框：紫色 → 琥珀色 (`border-amber-300`)
- ✅ 图谱背景：深紫色 → 浅琥珀色 (`from-amber-200 to-yellow-300`)
- ✅ 章节标签：紫色 → 琥珀色 (`text-amber-700`)
- ✅ 加载动画：紫色 → 琥珀色 (`border-amber-800`)

### 🐛 Bug 修复
**图谱刷新问题**

**问题**：点击下一页时，右侧人物关系图不会自动更新

**原因**：文本提取只在 `rendered` 事件触发，但页面切换时不一定触发该事件

**解决方案**：
- 在 `relocated` 事件（每次页面位置改变时）中添加文本提取
- 使用 `setTimeout` 确保内容已加载
- 每次翻页都会扫描当前页文本并更新图谱

**代码变更**：
```javascript
newRendition.on('relocated', (location) => {
  // ... 现有代码 ...
  
  // 新增：每次翻页都提取文本更新图谱
  setTimeout(() => {
    newRendition.getContents().forEach(contents => {
      const text = contents.document.body.textContent || ''
      onTextUpdate(text)
    })
  }, 100)
})
```

### 📋 受影响的文件

1. `src/App.jsx`
   - 主背景色调

2. `src/components/ChapterReader.jsx`
   - 顶部导航栏颜色
   - 按钮颜色
   - 章节列表悬停效果
   - 加载动画颜色
   - **图谱刷新逻辑（重要）**

3. `src/components/GraphVisualization.jsx`
   - 图谱背景颜色
   - 控制面板按钮颜色
   - 章节显示颜色

### 🎯 效果

**视觉效果**：
- 整体从冷色调（紫色）变为暖色调（琥珀/卡其色）
- 更接近古典书籍的色调
- 温暖舒适的阅读体验

**功能改进**：
- 每次翻页（上一页/下一页）都会实时扫描文本
- 图谱立即显示新出现的人物
- 无需等待或手动刷新

### 🧪 测试建议

1. 启动项目：`docker-compose up`
2. 打开 http://localhost:4000
3. 观察整体色调是否为暖色系
4. 连续点击"下一页"按钮
5. 观察右侧图谱是否实时增加新人物节点
6. 使用键盘左右箭头键翻页
7. 确认每次翻页都触发图谱更新

### ✅ 验证清单

- [x] 主背景色改为琥珀色/黄色渐变
- [x] 所有紫色元素替换为琥珀色
- [x] 翻页时图谱自动刷新
- [x] 键盘快捷键翻页也触发刷新
- [x] 点击目录跳转章节触发刷新
- [x] 无控制台错误
- [x] 性能无明显下降

---

**更新完成时间**：2026-02-04
**迭代次数**：Ralph Loop Iteration 1
